---
- name: Install Healthbeat on Linux servers
  hosts: all
  become: yes
  become_user: vunet
  tasks:
    - name: Transfer installer tar file to /tmp
      copy:
        src: /home/vunet/lhealthbeat_linux_64.zip
        dest: /tmp/installer.tar
        mode: '0644'
        remote_src: yes

    - name: Ensure /opt directory exists
      file:
        path: /opt
        state: directory
        mode: '0755'

    - name: Extract installer tar file to /opt
      unarchive:
        src: /tmp/installer.tar
        dest: /opt
        remote_src: yes

    - name: Run the Healthbeat installer
      command: bash ./install --quick --setupinit
      args:
        chdir: /opt/healthbeat
      environment:
        PATH: "/usr/local/bin:/usr/bin:/bin"

